const inDir = 'node_modules/cesium/',
    outDir = './';

import fs from 'fs-extra'
import path from 'path'

const files = fs.readdirSync(inDir);
for (let i = 0; i < files.length; i++) {
    const inFile = files[i], outFile = path.join(outDir, inFile);
    try {
        if (inFile == 'package.json' || inFile == 'package.lock.json') {
            continue;
        }
        fs.copySync(path.join(inDir, inFile), outFile)
        console.log('copy file:' + inFile)
    } catch (err) {
        console.error(err)
    }
}
//
const cesiumFiles = [
    'node_modules/cesium/Build/Cesium/Cesium.d.ts',
    'node_modules/cesium/Build/CesiumUnminified/Cesium.d.ts',
    'node_modules/cesium/Source/Cesium.d.ts',
];
const patchCesiumType = 'patch/types/Cesium.d.ts'
let patchCesiumTypeCode = fs.readFileSync(patchCesiumType, { encoding: 'utf-8' })
for (let i = 0; i < cesiumFiles.length; i++) {
    const cesiumFile = cesiumFiles[i];
    let code = fs.readFileSync(cesiumFile, { encoding: 'utf-8' })
    code = code.replace('declare module "cesium" {', 'declare module cesium {\n' + patchCesiumTypeCode);
    code += `\n
declare const Cesium=cesium
export as namespace Cesium;
export =Cesium
export default Cesium;`
    fs.writeFileSync(cesiumFile.replace('node_modules/cesium/', ''), code, {
        encoding: 'utf-8'
    })
}