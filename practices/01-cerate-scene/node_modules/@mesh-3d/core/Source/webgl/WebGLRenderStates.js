import WebGLRenderState from "./WebGLRenderState.js";

function WebGLRenderStates() {

    let states = new WeakMap();

    /**
     * 
     * @param {Object} scene 
     * @param {Object} camera 
     * @returns {WebGLRenderState}
     */
    this.get = function get(scene, camera) {

        const cameras = states.get(scene);
        let state;

        if (cameras === undefined) {

            state = new WebGLRenderState();
            states.set(scene, new WeakMap());
            states.get(scene).set(camera, state);

        } else {

            state = cameras.get(camera);
            if (state === undefined) {

                state = new WebGLRenderState();
                state.camera = camera;
                cameras.set(camera, state);

            }

        }

        return state;

    }

    this.dispose = function dispose() {

        states = new WeakMap();

    }

    Object.defineProperties(this, {
        states: {
            get: function () {
                return states;
            }
        }
    })

}
export default WebGLRenderStates;